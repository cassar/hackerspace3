<% content_for :title, "Projects #{params[:search]}" %>
<main class="project_index">
  <h1>
    Team Projects for Competition <%= @competition.year %>
    <span class="search">
      <%= params[:search] %>
    </span>
  </h1>
  <% if @competition.started? FIRST_COMPETITION_TIME_ZONE %>
    <p>
      <%= link_to 'Download CSV', projects_path(format: 'csv'), class: 'download-csv' %>
    </p>
    <% if @competition.in_form_or_comp_window?(FIRST_COMPETITION_TIME_ZONE) || @competition.in_form_or_comp_window?(LAST_COMPETITION_TIME_ZONE) %>
      <% if user_signed_in? %>
        <% if @participating_competition_event.present? %>
          <% if @competition.in_form_or_comp_window?(@time_zone) %>
            <aside>
              <%= link_to 'Create New Team Project', new_team_path %>
            </aside>
          <% end %>
        <% else %>
          <p>
            <strong>Please register for a competition event to create a team.</strong>
          </p>
          <p>
            <%= link_to 'Competition Events', competition_events_path %>
          </p>
        <% end %>
      <% else %>
        <p>
          <strong>
            Log in to the Hackerspace and register for a competition event
            to create a team.
          </strong>
        </p>
      <% end %>
    <% end %>
    <div class="projects mt-4">
      <% projects.each do |project| %>
        <%= render partial: 'project_card', locals: { project: project } %>
      <% end %>
      <%== pagy_bootstrap_nav(pagy) %>
    </div>
  <% else %>
    <section class="later">
      <strong>
        Check back here at the commencement of the competition at <%= @competition.start_time.strftime("%I.%M %p %e %B %Y") %>
      </strong>
    </section>
  <% end %>
</main>
